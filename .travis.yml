dist: focal

language: go

git:
  submodules: false

before_install:
  # Install linux-kernel-headers package.
  - sudo apt-get install linux-headers-$(uname -r)

  # For parent repos (i.e. sysbox, sysbox-fs, sysbox-libs), let's avoid dealing with ssh-keys mess by simply replacing their
  # ssh url with an http one.
  - sed -i 's/git@github.com:/https:\/\/github.com\//' .gitmodules
  - git submodule update --init
  - sed -i 's/git@github.com:/https:\/\/github.com\//' sysbox-fs/.gitmodules
  - sed -i 's/git@github.com:/https:\/\/github.com\//' sysbox-libs/.gitmodules
  - git -C sysbox-fs submodule update --init
  - git -C sysbox-libs submodule update --init

script:
  - make sysbox
  - make test-sysbox-ci
  - sudo make test-cleanup
  - make test-sysbox-shiftuid-ci
